"use strict";function w(e,r){var t,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,r){if(e){if("string"==typeof e)return s(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?s(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length)return o&&(e=o),t=0,{s:r=function(){},n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,c=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return a=e.done,e},e:function(e){c=!0,n=e},f:function(){try{a||null==o.return||o.return()}finally{if(c)throw n}}}}function s(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=new Array(r);t<r;t++)o[t]=e[t];return o}function q(e,r,t){var o=document.createElement("div");"error"==t?o.classList.add("form__error"):"ok"==t&&o.classList.add("form__ok"),o.innerText=e,r.insertAdjacentElement("beforeend",o)}function b(){fetch("".concat(g,"/api/users/").concat(localStorage.getItem("userId"))).then(function(e){if(e.status)return e.json();throw new Error("Пользователь не найден")}).then(function(e){var r,t=e.data,o=w(d);try{for(o.s();!(r=o.n()).done;){var n=r.value;n.innerText=t[n.getAttribute("name")]}}catch(e){o.e(e)}finally{o.f()}f.setAttribute("src","".concat(g).concat(t.photoUrl))}).catch(function(e){console.log(e)})}var e,A=/^((([0-9A-Za-z]{1}[\x2D\.0-9A-z]+[0-9A-Za-z]{1})|([0-9\u0410-\u044F]{1}[\x2D\.0-9\u0410-\u044F]+[0-9\u0410-\u044F]{1}))@([\x2DA-Za-z]+\.){1,2}[\x2DA-Za-z]{2,})$/,g="https://academy.directlinedev.com",k=document.querySelector("body"),l=document.querySelector(".menu-wrapper"),i=document.querySelector(".open-menu-wrapper"),u=document.querySelector(".menu-wrapper__close"),m=document.querySelectorAll(".form"),d=document.querySelectorAll(".profile__data"),f=document.querySelector(".profile__photo"),_=document.querySelector(".profile__change-pass"),y=document.querySelector(".profile__change-data"),v=document.querySelector(".profile__delete"),p=document.querySelector(".change-password"),h=document.querySelector(".change-data"),S=document.querySelectorAll(".header__item"),L=document.querySelector(".header__item_active"),r=w(S);try{for(r.s();!(e=r.n()).done;){var I=e.value;I!=L&&(I.addEventListener("mouseenter",function(){L.style.color="#828282"}),I.addEventListener("mouseleave",function(){L.style.color="#070707"}))}}catch(e){r.e(e)}finally{r.f()}var S=document.querySelectorAll(".header button"),E=document.querySelectorAll(".menu-wrapper button"),x=document.querySelector(".profile-link"),T=document.querySelector(".menu-link");if(localStorage.getItem("token")&&localStorage.getItem("userId")){var j,t=w(S);try{for(t.s();!(j=t.n()).done;)j.value.classList.add("header__item_hide")}catch(e){t.e(e)}finally{t.f()}var P,o=w(E);try{for(o.s();!(P=o.n()).done;)P.value.classList.add("menu-wrapper__link_hide")}catch(e){o.e(e)}finally{o.f()}x.classList.remove("header__item_hide"),T.classList.remove("menu-wrapper__link_hide")}else{var D,n=w(S);try{for(n.s();!(D=n.n()).done;)D.value.classList.remove("header__item_hide")}catch(e){n.e(e)}finally{n.f()}var z,a=w(E);try{for(a.s();!(z=a.n()).done;)z.value.classList.remove("menu-wrapper__link_hide")}catch(e){a.e(e)}finally{a.f()}x.classList.add("header__item_hide"),T.classList.add("menu-wrapper__link_hide")}b(),i.addEventListener("click",function(){l.classList.remove("menu-wrapper_close"),k.style.overflow="hidden"}),u.addEventListener("click",function(){l.classList.add("menu-wrapper_close"),k.style.overflow="auto"}),_.addEventListener("click",function(){p.classList.remove("form_close"),k.style.overflow="hidden"}),y.addEventListener("click",function(){h.classList.remove("form_close"),k.style.overflow="hidden"}),v.addEventListener("click",function(){fetch("".concat(g,"/api/users/").concat(localStorage.getItem("userId")),{method:"DELETE",headers:{"Content-Type":"application/json","x-access-token":localStorage.getItem("token")}}).then(function(e){throw e.ok&&(localStorage.removeItem("token"),localStorage.removeItem("userId"),history.back()),new Error("Пользователя не существует")}).catch(function(e){console.error(e),localStorage.removeItem("token"),localStorage.removeItem("userId"),history.back()})});var F,c=w(m);try{for(c.s();!(F=c.n()).done;)!function(){var S=F.value,L=S.querySelector(".form__main"),e=L.querySelector(".form__close"),r=L.querySelector(".form__file-input"),t=L.querySelector(".form__file-label");e.addEventListener("click",function(){S.classList.add("form_close"),k.style.overflow="auto"}),r&&r.addEventListener("change",function(e){t.innerText=e.target.files[0].name}),L.addEventListener("submit",function(e){e.preventDefault();var u,n=L.querySelector(".form__submit"),r=!1,t=w(L.querySelectorAll(".form__item"));try{for(t.s();!(u=t.n()).done;){var o=u.value,a=!1,c=(o.classList.contains("form-input")&&(o=o.querySelector(".form__file-wrapper"),a=!0),o.querySelector(".form__input")),s=o.querySelector(".form__error"),m=!0;a||(m=A.test(c.value)),a||!c.classList.contains("form__input_required")||""!=c.value||s||"email"==c.name?a||m||"email"!=c.name||!c.classList.contains("form__input_required")||s?(!a&&s&&""!=c.value&&"email"!=c.name||s&&m)&&(s.remove(),c.classList.remove("form__input_empty")):(q('Please enter a valid email address (your entry is not in the format "somebody@example.com")',o,"error"),c.classList.add("form__input_empty"),n.classList.add("form__submit_error")):(q("This field is required",o,"error"),c.classList.add("form__input_empty"),n.classList.add("form__submit_error"),r=!0),s=o.querySelector(".form__error"),!a&&c.classList.contains("form__input_required")&&s&&(r=!0)}}catch(e){t.e(e)}finally{t.f()}if(r||(S.classList.contains("change-password")?(e=L.querySelector("input[name='newPassword']"),l=L.querySelector("input[name='newPasswordRepeat']"),e.value!=l.value&&(r=!0,q("Passwords must match",l.parentElement,"error"),l.classList.add("form__input_empty"),n.classList.add("form__submit_error")),r||n.classList.remove("form__submit_error")):n.classList.remove("form__submit_error")),!n.classList.contains("form__submit_error")){var e={},l=L.querySelectorAll(".form__input");if(S.classList.contains("change-data")){var d,f=new FormData,i=w(l);try{for(i.s();!(d=i.n()).done;){var _=d.value;f.set("".concat(_.name),"".concat(_.value))}}catch(e){i.e(e)}finally{i.f()}e={method:"PUT",headers:{"x-access-token":localStorage.getItem("token")},body:f}}else if(S.classList.contains("change-password")){var y,v={},p=w(l);try{for(p.s();!(y=p.n()).done;){var h=y.value;"newPasswordRepeat"!=h.name&&(v[h.name]=h.value)}}catch(e){p.e(e)}finally{p.f()}e={method:"PUT",headers:{"Content-Type":"application/json","x-access-token":localStorage.getItem("token")},body:JSON.stringify(v)}}fetch("".concat(g).concat("/api/users"),e).then(function(e){if(e.ok)return e.json();switch(e.status){case 401:localStorage.removeItem("token"),localStorage.removeItem("userId"),history.back();break;case 422:var r=L.querySelector("input[name='oldPassword']");q("Incorrect password",r.parentElement,"error"),r.classList.add("form__input_empty");break;default:throw new Error("Ошибка сервера")}}).then(function(e){e.data;var r,t=w(L.querySelectorAll(".form__item"));try{for(t.s();!(r=t.n()).done;){var o=r.value;q("All right",o,"ok"),o.querySelector("input").classList.add("form__input_ok")}}catch(e){t.e(e)}finally{t.f()}n.classList.add("form__submit_ok"),b(),setTimeout(function(){S.classList.add("form_close");var e,r=w(L.querySelectorAll(".form__item"));try{for(r.s();!(e=r.n()).done;){var t=e.value;t.querySelector(".form__ok").remove(),t.querySelector("input").classList.remove("form__input_ok")}}catch(e){r.e(e)}finally{r.f()}n.classList.remove("form__submit_ok"),k.style.overflow="auto"},2e3)}).catch(function(e){console.error(e)})}})}()}catch(e){c.e(e)}finally{c.f()}